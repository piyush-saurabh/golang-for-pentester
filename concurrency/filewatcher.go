// Watch a location on a file system and react as soon as a file appears there
// Sample Usecase:
// While testing for RCE, try to create a file in a particular directory (here /tmp/pentest/)
// Get notified, as soon as the file is created, create a notification

package main

import (
	"io/ioutil"
	"os"
)

const (
	watchPath  = "/tmp/pentest/"
	webhookurl = "https://webhook.site/#!/1f423a7c-0180-4e93-9a4c-1b20dec1c459"
)

// FileWatcher method watches a directory for the files it
func FileWatcher() {

	os.Mkdir(watchPath, 0777)

	// Infinite loop
	for {
		// Get the handle of the folder we want to watch
		d, _ := os.Open(watchPath)

		// Enumerate the content of the folder
		// -1 means return all the files found inside the directory
		// Readdir returns the Slice
		files, _ := d.Readdir(-1)

		for _, file := range files {
			filePath := watchPath + "/" + file.Name()
			f, _ := os.Open(filePath)
			data, _ := ioutil.ReadAll(f)
			f.Close()
			os.Remove(filePath)

			go func(data string) {

			}(string(data))
		}
	}

}
